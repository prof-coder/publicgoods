<!-- /templates/collection.liquid -->
<script>
  {% if customer.tags contains 'B2B' and collection.title == 'All Products' %}
    if (document.referrer.indexOf("https://www.publicgoods.com/account/login") > -1 || document.referrer.indexOf("https://www.publicgoods.com/account/activate/") > -1) {
	  window.location.href= '/collections/b2b'
    }
  {% endif %}
  {% if customer.tags contains 'free-product' and collection.title == 'All Products' %}
    if (document.referrer.indexOf("https://www.publicgoods.com/account/activate/") > -1) {
	  window.location.href= '/collections/zero-waste-1/products/reusable-cotton-tote-bag'
    }
  {% endif %}
    {% if customer.tags contains 'free-hair-body-bundle' or customer.tags contains 'free-dental-care-membership' or customer.tags contains 'free-italian-bundle' %}
    if (document.referrer.indexOf("https://www.publicgoods.com/account/activate/") > -1) {
	  window.location.href= 'https://www.publicgoods.com/pages/free-gift-with-membership'
    }
  {% endif %}
</script>

<style>
    
  {% if customer %}
    @media (max-width: 737px) {
      body {
        margin-top: 20px !important;
      }
    }
  {% endif %}
  
</style>

{% paginate collection.products by 300 %}



<div id="collection_hero" class='gift_collection_hero_image'>
  <div class="row clearfix">
    <h1 id='all-products-shop-all-title'>{{ collection.title }}</h1>
  </div>
</div>


<!-- <div id='mobile-product-filter'>
    <p id='mobile-categories-text'>Categories</p>
    <div id='mobile-filter-display'>
     {% for link in linklists.collections-filter.links %}
         {%- comment %}<locksmith:eb2a>{% endcomment -%}
           {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: link, subject_parent: linklists.collections-filter, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
         {%- comment %}</locksmith:eb2a>{% endcomment -%}
         {% if link.type == 'collection_link' %}
           {% assign linkCollection = link.object %}
            <div class="filter-collection-item filter-item-all-prod mobile-filter-collection-item">
                <a href="{{ link.url }}">
                  {% if linkCollection.image %}
                      <img src="{{ linkCollection.image.src | img_url: 'master' }}" alt="{{ linkCollection.title | escape  }}" />
                  {% else %}
                      <img src="{{ linkCollection.products.first.featured_image.src | product_img_url: 'small' }}" alt="{{ linkCollection.title | escape  }}" />
                  {% endif %}
                </a>
                <h2><a href="{{ link.url }}">{{link.title | upcase}}</a></h2>
            </div>
        {% endif %}
      {% endfor %}
    </div>
  </div> -->


<div id="page_content">
  {% unless collection.title == "All Products" %}
  <div class="row">
    <div class="column_12">
      <div class="collections clearfix">
        {% paginate collections.all-products.products by 300 %}
        {% for product in collection.products %}
{%- comment %}<locksmith:1246>{% endcomment -%}
  {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collection, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
{%- comment %}</locksmith:1246>{% endcomment -%}
{%- include 'bold-product-json', product: product -%}{% include 'easylockdown_filter_collection' with product %}

          {% assign name = 'product' | append:product.id %}
          {% assign idNo = name | append:'-no' %}
          {% assign idYes = name | append:'-yes' %}
		  
          {% assign checkedNo = 'checked' %}
          {% assign checkedYes = '' %}
          {% assign opacityClass = '' %}
          {% assign available = true %}

          {% if product.variants[0].inventory_quantity <= 10 %}
          	{% assign available = false %}
          {% endif %}

          {% if shop.customer_accounts_enabled %}
          	{% if customer %}
              {% assign checkedNo = 'disabled' %}
              {% assign checkedYes = 'checked' %}
              {% assign opacityClass = 'opacity-3' %}

              {% assign available = true %}
              {% if product.variants[0].inventory_quantity <= 10 %}
                {% assign available = false %}
              {% endif %}
            {% endif %}
          {% endif %}
        
          <div class="collection">
            <div class="collection_header">
              <a href="{{ product.url | within: collection }}">
                <div class="reveal">
                  <img src="{{ product.featured_image.src | img_url: 'master' }}" alt="{{ product.featured_image.alt | escape }}">
                  <img class="hidden" src="{{ product.images.last | img_url: 'master' }}" alt="{{ product.images.last.alt | escape }}" />
                </div>
              </a>
              <div class="collection_action" rel="{{name}}">
                 {% if available == true %}
                	{% if customer %}
                    {% if product.variants.first.sku == "123" or product.variants.first.sku contains "Giftcard" %}
                        <a href="{{ product.url | within: collection }}">
                            <div class="collection_update">
                            </div>
                        </a>
                    {% else %}
                      <div class="collection_to_cart"  rel="{{name}}" onclick="pintrk('track', 'addtocart');">ADD TO CART</div>
                    {% endif %}
                	
                	{% else %}
                    {% if product.variants.first.sku == "123" or product.variants.first.sku contains "Giftcard" %}
                    
                      <a href="{{ product.url | within: collection }}">
                          <div class="collection_update">
                          </div>
                      </a>
                      <!--  HERE HERE HERE  -->
                      <!-- <div class="collection_to_cart" rel="{{name}}">ADD TO CART</div> -->
                      <!--  HERE HERE HERE  -->
                    {% else %}
                	    <div class="collection_to_cart" rel="{{name}}">ADD TO CART</div>
                    {% endif %}
                	{% endif %}
                	<div class="collection_update">
                      <div class="collection_update_spans clearfix">
                        <span class="collection_minus" rel="{{name}}"></span>
                        <div>
                          <span class="collection_count" id="collection_count_{{product.id}}"></span> IN CART
                        </div>
                        <span class="collection_plus" rel="{{name}}"></span>
                      </div>
                    </div>
                {% else %}
                	<div class="collection_coming_soon">SOLD OUT</div>
                {% endif %}
              </div> <!-- Collection Action End !-->
            </div>
            <div class="collection_body">
              
              <label class="collection_title all-products-product-stars"><a href="{{ product.url | within: collection }}">{{ product.title }}</a> 
                <a href="{{ product.url | within: collection | append: '#anchor-reviews'}}">  <!--- Star Reviews !--->
                  <div class="yotpo bottomLine yotpo-small"
                    data-appkey="1czk4hDZQU9jrmp3MaNi1wqhc05RABHrg6aDSVLd"
                    data-domain="{{shop.permanent_domain | escape }}"
                    data-product-id="{{ product.id }}"
                    data-product-models="{{ product.id }}"
                    data-name="{{ product.title | escape }}"
                    data-url="{{ shop.url }}{{ product.url }}"
                    data-image-url="{{ product.featured_image | product_img_url: 'large' |replace: '?', '%3F' | replace: '&','%26'}}"
                    data-description="{{ product.description | escape }}"
                    data-bread-crumbs="{% for tag in product.tags %}{{ tag | escape }};{% endfor %}">
                  </div>
                </a>
              </label>
              
               {% if customer and product.variants.first.sku != "Giftcard10" %}
              	<div class="var_checkbox"><input type="hidden" name="{{name}}" id="{{idYes}}" value="{{ product.variants[0].id }}" class="productYes" {{checkedYes}}/><label style="cursor:default;" for="{{idYes}}" onclick="">{{ product.variants[0].price | money }} <font>{{ product.variants[0].title | remove: '(member)'}}<small>{% unless customer %}<!-- With membership, from $59 / year -->{% endunless %}</small></font></label></div>
              {% else %}
              	{% if product.variants.first.sku != "Giftcard10" %}
				  <a class="subscribe-to-membership-32-45 subscribe-to-membership membuttonclick free"><div><input type="hidden" name="{{name}}" id="{{idYes}}" value="{{ product.variants[0].id }}" class="productYes" {{checkedYes}}/><label style="color:#000; " for="{{idYes}}" onclick="">{{ product.variants[0].price | money }} <font>{{ product.variants[0].title }} <small>{% unless customer %}<!-- With membership, from $59 / year -->{% endunless %}</small></font></label></div></a>
                {% endif %}
              {% endif %}

            </div>
          </div>
  

        {% endfor %}
        
        {% if paginate.pages > 1 %}
        <div class="pagination">
          {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
        </div>
      {% endif %}
 {% endpaginate %}
      </div> <!-- Collections End !-->
    </div>
    
      <div id='filter-separator'>
    <h1>All Products</h1>
  </div>
  </div><!-- Row End !-->
  
  

    {% endunless %}
  <div class="row">
    <div class="column_12">
      <div class="collections clearfix">
        {% paginate collections.all-products.products by 300 %}
        {% for product in collections.all-products.products %}
        
          {%- comment %}<locksmith:a8dc>{% endcomment -%}
            {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collections.all-products, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
          {%- comment %}</locksmith:a8dc>{% endcomment -%}
        
          {% if collection.title == "Bathroom" %}
            {% assign collectionTag = "bathroom" %}
          {% endif %}
        
          {% if collection.title == "Bundles" %}
              {% assign collectionTag = "bundle" %}
            {% endif %}

          {% if collection.title == "Candles" %}
              {% assign collectionTag = "candles" %}
            {% endif %}
        
         {% if collection.title == "Canned Goods" %}
              {% assign collectionTag = "canned-food" %}
            {% endif %}

          {% if collection.title == "Cereal and Breakfast" %}
              {% assign collectionTag = "cereal-breakfast" %}
            {% endif %}

          {% if collection.title == "Cleaners" %}
              {% assign collectionTag = "cleaners" %}
            {% endif %}

          {% if collection.title == "Coffee and Tea" %}
              {% assign collectionTag = "coffee-tea" %}
            {% endif %}

          {% if collection.title == "Condiments" %}
              {% assign collectionTag = "condiments" %}
            {% endif %}

          {% if collection.title == "Crackers" %}
              {% assign collectionTag = "crackers" %}
            {% endif %}

          {% if collection.title == "Dental Care" %}
              {% assign collectionTag = "dental" %}
            {% endif %}

          {% if collection.title == "Essential Oils" %}
              {% assign collectionTag = "oil" %}
            {% endif %}

          {% if product.type == 'Gifts' %}
              {% assign collectionTag = "gifts" %}
            {% endif %}

          {% if collection.title == "Hair and Body" %}
              {% assign collectionTag = "hair" %}
	          {% assign collectionTag2 = true %}
            {% endif %}

          {% if collection.title == "Household" %}
              {% assign collectionTag = "household" %}
            {% endif %}

          {% if collection.title == "Kitchen" %}
              {% assign collectionTag = "kitchen" %}
            {% endif %}

          {% if collection.title == "Laundry" %}
              {% assign collectionTag = "laundry" %}
            {% endif %}

          {% if collection.title == "Linens" %}
              {% assign collectionTag = "linen" %}
            {% endif %}

          {% if collection.title == "Oils and Vinegars" %}
              {% assign collectionTag = "oils-vinegars" %}
            {% endif %}

          {% if collection.title == "Pasta and Sauce" %}
              {% assign collectionTag = "grains-pasta" %}
            {% endif %}

          {% if collection.title == "Personal Care" %}
              {% assign collectionTag = "personal care" %}
            {% endif %}

          {% if collection.title == "Protein Powders" %}
              {% assign collectionTag = "protein-powders" %}
            {% endif %}

          {% if collection.title == "Snacks" %}
              {% assign collectionTag = "snacks" %}
            {% endif %}
        
        {% if collection.title == "Soups" %}
              {% assign collectionTag = "soups" %}
            {% endif %}
        
        {% if collection.title == "Travel" %}
              {% assign collectionTag = "travel" %}
            {% endif %}
        
        {% if collection.title == "Tree Free Paper" %}
              {% assign collectionTag = "treefree" %}
            {% endif %}
        
         {% if collection.title == "Zero Waste" %}
              {% assign collectionTag = "zero-waste" %}
            {% endif %}
        
        {% if collection.title == "Food" %}
          {% assign collectionTag = "grocery" %}
        {% endif %}
        
        {% if collection.title == "Vitamins and Supplements" %}
          {% assign collectionTag = "vitamin-supplements" %}
        {% endif %}
        
        {% if collection.title == "Menstrual Care" %}
          {% assign collectionTag = "menstrual-care" %}
        {% endif %}
        
          {% unless product.tags contains collectionTag %} 
			        
            {% assign name = 'product' | append:product.id %}
            {% assign idNo = name | append:'-no' %}
            {% assign idYes = name | append:'-yes' %}

            {% assign checkedNo = 'checked' %}
            {% assign checkedYes = '' %}
            {% assign opacityClass = '' %}
            {% assign available = true %}

            {% if product.variants[0].inventory_quantity <= 20 %}
              {% assign available = false %}
            {% endif %}

            {% if shop.customer_accounts_enabled %}
              {% if customer %}
                  {% assign checkedNo = 'disabled' %}
                  {% assign checkedYes = 'checked' %}
                  {% assign opacityClass = 'opacity-3' %}

                  {% assign available = true %}
                  {% if product.variants[0].inventory_quantity <= 20 %}
                      {% assign available = false %}
                  {% endif %}
              {% endif %}
            {% endif %}

           <div class="collection">
            <div class="collection_header">
              <a href="{{ product.url | within: collection }}">
                <div class="reveal">
                  <img src="{{ product.featured_image.src | img_url: 'master' }}" alt="{{ product.featured_image.alt | escape }}">
                  <img class="hidden" src="{{ product.images.last | img_url: 'master' }}" alt="{{ product.images.last.alt | escape }}" />
                </div>
              </a>
             <div class="collection_action" rel="{{name}}">
                {% if available == true %}
                	{% if customer %}
                	   {% if product.variants.first.sku contains "Giftcard" or product.variants.first.sku == "123"%}
                          <a href="{{ product.url | within: collection }}">
                              <div class="collection_update">
                              </div>
                          </a>
                       {% else %}
                	     <div class="collection_to_cart" rel="{{name}}" onclick="pintrk('track', 'addtocart');">ADD TO CART</div>
                       {% endif %}
                	{% else %}
                	  <div class="collection_to_cart subscribe-to-membership subscribe-to-membership-32-45" rel="{{name}}">ADD TO CART</div>
                	{% endif %}
                	<div class="collection_update">
                      <div class="collection_update_spans clearfix">
                        <span class="collection_minus" rel="{{name}}"></span>
                        <div>
                          <span class="collection_count" id="collection_count_{{product.id}}"></span> IN CART
                        </div>
                        <span class="collection_plus" rel="{{name}}"></span>
                      </div>
                    </div>
                {% else %}
                <div class="collection_coming_soon"><a href="{{ product.url | within: collection }}#sold-out">SOLD OUT</a></div>
                {% endif %}
              </div> <!-- Collection Action End !-->
            </div>
            <div class="collection_body">
              
              <label class="collection_title all-products-product-stars"><a href="{{ product.url | within: collection }}">{{ product.title }}</a> 
                <a href="{{ product.url | within: collection | append: '#anchor-reviews'}}">  <!--- Star Reviews !--->
                  <div class="yotpo bottomLine yotpo-small"
                    data-appkey="1czk4hDZQU9jrmp3MaNi1wqhc05RABHrg6aDSVLd"
                    data-domain="{{shop.permanent_domain | escape }}"
                    data-product-id="{{ product.id }}"
                    data-product-models="{{ product.id }}"
                    data-name="{{ product.title | escape }}"
                    data-url="{{ shop.url }}{{ product.url }}"
                    data-image-url="{{ product.featured_image | product_img_url: 'large' |replace: '?', '%3F' | replace: '&','%26'}}"
                    data-description="{{ product.description | escape }}"
                    data-bread-crumbs="{% for tag in product.tags %}{{ tag | escape }};{% endfor %}">
                  </div>
                </a>
              </label>
             
              
<!--               <div><input type="hidden" rel="{{product.variants[0].inventory_quantity}}" name="{{name}}" id="{{idNo}}" value="{{ product.variants[0].id }}" class="productNo" {{checkedNo}}/><label for="{{idNo}}" onclick="">{{ product.variants[0].price | money }}</label></div> -->

              {% if customer and product.variants.first.sku != "Giftcard10" %}
              	<div class="var_checkbox"><input type="hidden" name="{{name}}" id="{{idYes}}" value="{{ product.variants[0].id }}" class="productYes" {{checkedYes}}/><label style="cursor:default;" for="{{idYes}}" onclick="">{{ product.variants[0].price | money }} <font>{{ product.variants[0].title | remove: '(member)'}}<small>{% unless customer %}<!-- With membership, from $59 / year -->{% endunless %}</small></font></label></div>
              {% else %}
              	{% if product.variants.first.sku != "Giftcard10" %}
				  <a class="subscribe-to-membership-32-45 subscribe-to-membership membuttonclick free"><div><input type="hidden" name="{{name}}" id="{{idYes}}" value="{{ product.variants[0].id }}" class="productYes" {{checkedYes}}/><label style="color:#000; " for="{{idYes}}" onclick="">{{ product.variants[0].price | money }} <font>{{ product.variants[0].title }} <small>{% unless customer %}<!-- With membership, from $59 / year -->{% endunless %}</small></font></label></div></a>
                {% endif %}
              {% endif %}
              
              
            </div>
          </div>
          {% endunless %}
        {% endfor %}
      </div> <!-- Collections End !-->
      {% if paginate.pages > 1 %}
        <div class="pagination">
          {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
        </div>
      {% endif %}
      {% endpaginate %}
    </div>
  </div><!-- Row End !-->
    <div class="shop-by-category">
      <div class="main-categories">
        <div class="main-categories-tile main-categories-pc">
          <div class="main-categories-words">
            <h2>Personal Care</h2>
            <a href="https://www.publicgoods.com/collections/personal-care">shop all</a>
          </div>
        </div>
        <div class="main-categories-tile main-categories-household">
          <div class="main-categories-words">
            <h2>Home Essentials</h2>
            <a href="https://www.publicgoods.com/collections/household">shop all</a>
          </div>
        </div>
        <div class="main-categories-tile main-categories-food">
          <div class="main-categories-words">
            <h2>Healthy Food</h2>
            <a href="https://www.publicgoods.com/collections/grocery">shop all</a>
          </div>
        </div>
         <div class="main-categories-tile main-categories-vitamins">
          <div class="main-categories-words">
            <h2>Vitamins and Supplements</h2>
            <a href="https://www.publicgoods.com/collections/vitamins-and-supplements">shop all</a>
          </div>
        </div>
      </div>
  </div>

</div> <!-- Page Content End !-->





{% endpaginate %}

{% include 'smooth-scroll-all-prod' %}
{% include 'reactivate-popup' %}

<script type="text/javascript" language="javascript">
  // var member = 0; > var member = 1; nonmebers can add gift carts to cart
  var member = 1;
  var idNo_modal = '';
  var idYes_modal = '';

  {% if shop.customer_accounts_enabled %}
    {% if customer %}
      member = 1;
    {% endif %}
  {% endif %}

  $(document).ready(function(){
    
    // Update cart count for incase of cache issue
    (function() {
    
      jQuery.getJSON('/cart.js', function(cart) {
        console.log('in')
          $('#CartCount').html(cart.item_count);
      });
      
    })()
    
    
    var modal = $('#customModal');
    var modalDom = document.getElementById('customModal');

    var cart_items = {};

    $('.productYes').click(function(){
      console.log("here2222");
      if(member == 0){
        $("a#membership_button_11118").click();

        // modal.show();
        // $('body').css('overflow', 'hidden');

        var name = $(this).parents('.collection:first').find('.collection_action:first').attr('rel');

        idNo_modal = name + '-no';
        idYes_modal = name + '-yes';
        
        $('#'+idYes_modal).removeAttr('checked');
        $('#'+idNo_modal).prop('checked',true);
      }
    });

    $('.collection_minus').click(function(){
      var object = $(this).parents('.collection_update_spans:first');
      var quantity_object = object.find('.collection_count:first');
      var total_quantity = parseInt(quantity_object.html());
      var name = $(this).attr('rel');
      
      var idNo = name + '-no';
      var idYes = name + '-yes';

      var variantId = $('#'+idNo).val();
      if($('#'+idYes).prop('checked'))
        variantId = $('#'+idYes).val();

      var quantity = find_cart_quantity(variantId, 'minus');

      $.ajax({
        type:'POST', 
        url:'/cart/change.js', 
        data: {id: variantId, quantity: quantity}, 
        dataType: 'json',
        success: function(data){
            setCartItem(variantId, {id: $('#'+idYes).val(), quantity: quantity});
            if(total_quantity > 1)
                quantity_object.html(total_quantity-1);
            else
                get_cart_items();
            
            update_cart_count('minus');
        }
      });  
    });

    $('.collection_plus').click(function(){
      var object = $(this).parents('.collection_update_spans:first');
      var quantity_object = object.find('.collection_count:first');
      var total_quantity = parseInt(quantity_object.html());
      var name = $(this).attr('rel');
      
      var idNo = name + '-no';
      var idYes = name + '-yes';

      var variantId = $('#'+idNo).val();
      if($('#'+idYes).prop('checked'))
        variantId = $('#'+idYes).val();

      var quantity = find_cart_quantity(variantId, 'plus');

      $.ajax({
        type:'POST', 
        url:'/cart/change.js', 
        data: {id: variantId, quantity: quantity}, 
        dataType: 'json',
        success: function(data){
            setCartItem(variantId, {id: $('#'+idYes).val(), quantity: quantity});
            quantity_object.html(total_quantity+1);
            update_cart_count('plus');
        }
      });  
    });

    $('.collection_to_cart').click(function(e){
	
      e.preventDefault()
      
      var name = $(this).attr('rel');
      
      var object = $(this).parents('.collection_action:first');

      var idNo = name + '-no';
      var idYes = name + '-yes';

      // var variantId = $('#'+idNo).val();
      //if($('#'+idYes).prop('checked'))
      var variantId = $('#'+idYes).val();

      {% for tag in customer.tags %}
        {% if tag == 'member' or tag == 'members' %}
          {% assign nonmember = false %}
        {% endif %}
        {% if tag == 'Unsubscribed' or tag == 'unsubscribed' %}
          {% assign nonmember = true %}
        {% endif %}
      {% endfor %}
      // {% assign nonmember = false %} nonmebers can add gift carts to cart
      {% assign nonmember = false %}
      
      {% if customer.tags contains 'lifetime' %}
        {% assign nonmember = false %}
      {% endif %}
      
      {% if nonmember == true %}
      	$('#reactivate-pop-up-wrapper').css('display', 'block')
        let popupWidth = (window.innerWidth - $('#reactivate-pop-up-wrapper').width()) / 2
        $('#reactivate-pop-up-wrapper').css('right', popupWidth )
      {% endif %}
	
      //debugger
      {% if nonmember == false %}
        $.ajax({
          type:'POST', 
          url:'/cart/add', 
          data: {id: variantId}, 
          dataType: 'json',
          success: function(data){
              get_cart_items();
              update_cart_count('plus');
              setCartItem(variantId, {id: $('#'+idYes).val(), quantity: 1});
          },
          error: function(){
            ///debugger
          }
        });
      {% endif %}
    });
	
    $('#boldTrigger').click(function(){
    	$('.modal-close').click();
      	$('#checkout_11118 a').click();
    });
    
    $('.modal-close').click(function(){
      modal.hide();
      $('body').css('overflow', 'auto');

      if(idYes_modal != '' && idNo_modal != ''){
        $('#'+idYes_modal).removeAttr('checked');
        $('#'+idNo_modal).prop('checked',true);

        idYes_modal = '';
        idNo_modal = '';
      }
    });

    $(window).click(function(e){
      if (e.target == modalDom){
        modal.hide();
        $('body').css('overflow', 'auto');

        if(idYes_modal != '' && idNo_modal != ''){
          $('#'+idYes_modal).removeAttr('checked');
          $('#'+idNo_modal).prop('checked',true);

          idYes_modal = '';
          idNo_modal = '';
        }
      }
    });

    function get_cart_items(){
        $('.collection_to_cart').show();
        $('.collection_update').hide();
        $('.collection_update').css('opacity', 0);

        $.ajax({
          type:'GET', 
          url:'/cart.js', 
          dataType: 'json',
          success: function(data){
            var items = data.items;

            cart_items = items;

            for(var i in items){
              var temp = [];

              if(items[i].merged)
                continue;

              temp.product_id = items[i].product_id;
              temp.quantity = parseInt(items[i].quantity);
              items[i].merged = true;

              for(var j in items){
                if(i >= j || items[j].merged)
                  continue;

                if(items[i].product_id == items[j].product_id){
                  temp.quantity += parseInt(items[j].quantity);
                  items[j].merged = true;
                }
              }

              var id = 'collection_count_' + temp.product_id;
              $('#'+id).html(temp.quantity);

              var object = $('#'+id).parents('.collection_action:first');
              object.find('.collection_to_cart:first').hide();
              object.find('.collection_update:first').show();
              object.find('.collection_update:first').css('opacity', 1);
            }
          }
        });
    }
    
    $('body').on('afterChangeItem.ajaxCart', function(evt, cart) {
      get_cart_items();
    });

    $('body').on('afterAddItem.ajaxCart', function(evt, cart) {
      get_cart_items();
    });

    function find_cart_quantity(id, action){
        var quantity = 0;
        if(cart_items.length > 0){
            for(var i in cart_items){
                if(cart_items[i].id == id){
                    if(action == 'minus')
                        cart_items[i].quantity -= 1;
                    else if(action == 'plus')
                        cart_items[i].quantity += 1;      

                    quantity = cart_items[i].quantity;

                    break;
                }
            }
        }

        return parseInt(quantity);
    }

    function update_cart_count(action){
        var quantity = parseInt($('#CartCount').html());
        
        if(action == 'minus')
            quantity--;
        else if(action == 'plus')
            quantity++;

        $('#CartCount').html(quantity);
        $('#CartCount_mobile').html(quantity);
    }

    get_cart_items();
    
    $(window).load(function(){
      var match = new RegExp('[?&]cart=([^&]*)').exec(window.location.href);

      var param = match && decodeURIComponent(match[1].replace());

      if(param == 'show'){
          ajaxCart.load();
          timber.RightDrawer.open()
      }
    });
  });
  
//     $(window).scroll(function () {
//       //set scroll position in session storage
//       sessionStorage.scrollPos = $(window).scrollTop();
//     });
//     var init = function () {
//        //return scroll position in session storage
//        $(window).scrollTop(sessionStorage.scrollPos || 0)
//     };
//     window.onload = init;

</script>

<style>
  .shop-by-category {
    text-align: center;
    width: 90%;
    margin: 0 auto;
  }
  
  .main-categories {
    display: flex;
    height: 230px;
    justify-content: space-between;
    margin-bottom: 50px;
  }

  .main-categories-tile {
    width: 24%;
    background-size: cover;
    background-position-y: 100%;
    cursor: pointer;
  }

  .main-categories-pc {
    background-image: url("https://cdn.shopify.com/s/files/1/0838/7991/files/tile_personal_care.jpg?12413255820896601983")
  }

  .main-categories-household {
    background-image: url("https://cdn.shopify.com/s/files/1/0838/7991/files/tile_household.jpg?12413255820896601983")
  }

  .main-categories-food {
    background-image: url("https://cdn.shopify.com/s/files/1/0838/7991/files/tile_food.jpg?12413255820896601983")  
  }

  .main-categories-vitamins {
    background-image: url(https://cdn.shopify.com/s/files/1/0838/7991/files/tile_vitamins_retouch.jpg?41730);
    background-position-x: 85%;
  }

  .main-categories-words {
    margin-top: 120px;
  }

  .main-categories-words a {
    color: #000;
    text-decoration: underline;
    margin-top: 5px;
  }

  .main-categories-words h2 {
    margin-bottom: 5px;
    line-height: 24px;
  }
  
  @media (max-width: 1300px) {
    .main-categories-household {
      background-position-x: 35%;
    }
    .main-categories-food {
      background-position-x: 75%;
    }
  }
  
  @media (max-width: 1000px) {
    .main-categories {
      display: block;
      height: auto;
      text-align: -webkit-center;
      text-align: -moz-center;
    }

    .main-categories-household {
      margin: 50px 0;
    }

    .main-categories-vitamins {
      margin-top: 50px;
    }

    .main-categories-tile {
      width: 75%;
      height: 300px;
    }

    .main-categories-words {
      margin-top: 0;
      padding-top: 140px;
    }
  
  }
  
  @media (max-width: 600px) {
   .main-categories-tile {
      width: 100%;
    }
  }
  
  @media (max-width: 460px) {
    .main-categories-tile {
      background-position: bottom;
    }
  }
  
  
</style>