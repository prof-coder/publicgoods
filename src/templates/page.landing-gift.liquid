<!-- Bold: Memberships (page) -->
{% include 'bold_mem_helper' with 'page' %}
<!-- end Bold code -->

<!-- /templates/page.liquid -->
<div id="gift-wrapper">
  <div class="gift-top-div">
    <div class="gift-top-title">
      <h1>Holiday <br>homestretch.</h1>
    </div>
    <div class="gift-main-words">
      <p>Itâ€™s almost time. <br>Thoughtful gifts for anyone with a handwriten note on us.</p>
    </div>
  </div>
  <div class="gift-bottom-div">
    <div class="row">
    <div class="column_12">
      <div class="collections clearfix">
        {% for product in collections.gifts.products %}

           {%- comment %}<locksmith:fb6a>{% endcomment -%}
             {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collections.gifts, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
           {%- comment %}</locksmith:fb6a>{% endcomment -%}

           {% assign name = 'product' | append:product.id %}
          {% assign idNo = name | append:'-no' %}
          {% assign idYes = name | append:'-yes' %}
		  
          {% assign checkedNo = 'checked' %}
          {% assign checkedYes = '' %}
          {% assign opacityClass = '' %}
          {% assign available = true %}

          {% if product.variants[0].inventory_quantity <= 0 %}
          	{% assign available = false %}
          {% endif %}

          {% if shop.customer_accounts_enabled %}
          	{% if customer %}
        		{% assign checkedNo = 'disabled' %}
        		{% assign checkedYes = 'checked' %}
        		{% assign opacityClass = 'opacity-3' %}

        		{% assign available = true %}
        		{% if product.variants[0].inventory_quantity <= 0 %}
        			{% assign available = false %}
        		{% endif %}
        	{% endif %}
          {% endif %}
        
          <div class="collection">
            <div class="collection_header">
              <a href="{{ product.url | within: collection }}">
                <img src="{{  product.images[0] | img_url: 'master' }}" alt="{{ product.featured_image.alt | escape }}">
              </a>
              <div class="collection_action" rel="{{name}}">
                {% if available == true %}
                
                  {% if product.variants.first.sku == "123" %}
                  <a href="{{ product.url | within: collection }}">
                      <div class="collection_update">
                      </div>
                  </a>
                  {% else %}
                 <a href="#">
                  <div class="collection_to_cart" rel="{{name}}">ADD TO CART</div>
                </a>
                      <div class="collection_update">
                        <div class="collection_update_spans clearfix">
                          <span class="collection_minus" rel="{{name}}"></span>
                          <div>
                            <span class="collection_count" id="collection_count_{{product.id}}"></span> IN CART
                          </div>
                          <span class="collection_plus" rel="{{name}}"></span>
                        </div>
                      </div>
                  {% endif %}
                {% else %}
                	<div class="collection_coming_soon">SOLD OUT</div>
                {% endif %}
              </div> <!-- Collection Action End !-->
            </div>
            <div class="collection_body">
              <label class="collection_title">{{ product.title }}</label>
             
              
              <div><input type="hidden" rel="{{product.variants[0].inventory_quantity}}" name="{{name}}" id="{{idNo}}" value="{{ product.variants[0].id }}" class="productNo" {{checkedNo}}/><label for="{{idNo}}" onclick="">{{ product.variants[0].price | money }}</label></div>

            </div>
          </div>
        {% endfor %}
      </div> <!-- Collections End !-->
      {% if paginate.pages > 1 %}
        <div class="pagination">
          {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
        </div>
      {% endif %}
    </div>
  </div><!-- Row End !-->
</div> <!-- Page Content End !-->
</div>




<style>
  
  .gift-top-div {
    height: 700px;
    background: url(https://cdn.shopify.com/s/files/1/0838/7991/files/gift_header_with-Note_ext2.jpg?7824481004880222299);
    background-position: center;
    background-size: cover;
    text-align: -webkit-center;
    text-align: -moz-center;
  }
  
  .gift-top-title {
    text-align: center;
    padding-top: 50px;
  }
  
  .gift-bottom-div {
    margin-top: 50px;
  }
  
  .gift-main-words {
    width: 400px;
    text-align: center;
    padding-top: 440px;
  }
  
  .gift-main-words p {
    font-size: 18px;
    line-height: 26px;
  }
  
  @media (min-width: 1750px) {
    .gift-top-title {
      padding-top: 30px;
    }
    .gift-main-words {
      padding-top: 470px;
    }
  }
  
  @media (max-width: 737px) {
    .gift-top-div {
      height: 500px;
      background: url(https://cdn.shopify.com/s/files/1/0838/7991/files/737x500.jpg?8569841479870037716);
      background-position: center;
      background-size: cover;
    }
    .gift-main-words {
      width: 400px;
      padding-top: 270px;
    }
  }
  
  @media (max-width: 415px) {
    .gift-main-words p {
      font-size: 16px;
      line-height: 23px;
    }
    .gift-main-words {
      width: 275px;
    }
  }
  
  @media (max-width: 380px) {
    .gift-top-div {
      background: url(https://cdn.shopify.com/s/files/1/0838/7991/files/600.jpg?15075220714449419200);
      background-position: center;
      background-size: cover;
    }
  }
  
</style>
<script type="text/javascript" language="javascript">
  var member = 0;
  var idNo_modal = '';
  var idYes_modal = '';

  {% if shop.customer_accounts_enabled %}
    {% if customer %}
      member = 1;
    {% endif %}
  {% endif %}

  $(document).ready(function(){
    var modal = $('#customModal');
    var modalDom = document.getElementById('customModal');

    var cart_items = {};

    $('.productYes').click(function(){
      console.log("here2222");
      if(member == 0){
        $("a#membership_button_11118").click();

        // modal.show();
        // $('body').css('overflow', 'hidden');

        var name = $(this).parents('.collection:first').find('.collection_action:first').attr('rel');

        idNo_modal = name + '-no';
        idYes_modal = name + '-yes';
        
        $('#'+idYes_modal).removeAttr('checked');
        $('#'+idNo_modal).prop('checked',true);
      }
    });

    $('.collection_minus').click(function(){
      var object = $(this).parents('.collection_update_spans:first');
      var quantity_object = object.find('.collection_count:first');
      var total_quantity = parseInt(quantity_object.html());
      var name = $(this).attr('rel');
      
      var idNo = name + '-no';
      var idYes = name + '-yes';

      var variantId = $('#'+idNo).val();
      if($('#'+idYes).prop('checked'))
        variantId = $('#'+idYes).val();

      var quantity = find_cart_quantity(variantId, 'minus');

      $.ajax({
        type:'POST', 
        url:'/cart/change.js', 
        data: {id: variantId, quantity: quantity}, 
        dataType: 'json',
        success: function(data){
            setCartItem(variantId, {id: $('#'+idYes).val(), quantity: quantity});
            if(total_quantity > 1)
                quantity_object.html(total_quantity-1);
            else
                get_cart_items();
            
            update_cart_count('minus');
        }
      });  
    });

    $('.collection_plus').click(function(){
      var object = $(this).parents('.collection_update_spans:first');
      var quantity_object = object.find('.collection_count:first');
      var total_quantity = parseInt(quantity_object.html());
      var name = $(this).attr('rel');
      
      var idNo = name + '-no';
      var idYes = name + '-yes';

      var variantId = $('#'+idNo).val();
      if($('#'+idYes).prop('checked'))
        variantId = $('#'+idYes).val();

      var quantity = find_cart_quantity(variantId, 'plus');

      $.ajax({
        type:'POST', 
        url:'/cart/change.js', 
        data: {id: variantId, quantity: quantity}, 
        dataType: 'json',
        success: function(data){
            setCartItem(variantId, {id: $('#'+idYes).val(), quantity: quantity});
            quantity_object.html(total_quantity+1);
            update_cart_count('plus');
        }
      });  
    });

    $('.collection_to_cart').click(function(e){
      e.preventDefault()
      var name = $(this).attr('rel');
      
      var object = $(this).parents('.collection_action:first');

      var idNo = name + '-no';
      var idYes = name + '-yes';

      var variantId = $('#'+idNo).val();
      if($('#'+idYes).prop('checked'))
        variantId = $('#'+idYes).val();
      
      {% for tag in customer.tags %}
        {% if tag == 'member' or tag == 'members' %}
          {% assign nonmember = false %}
        {% endif %}
        {% if tag == 'Unsubscribed' or tag == 'unsubscribed' %}
          {% assign nonmember = true %}
        {% endif %}
      {% endfor %}
	
      {% if nonmember == false %}
        $.ajax({
          type:'POST', 
          url:'/cart/add', 
          data: {id: variantId}, 
          dataType: 'json',
          success: function(data){
              get_cart_items();
              update_cart_count('plus');
              setCartItem(variantId, {id: $('#'+idYes).val(), quantity: 1});
          }
        });
      {% endif %}
      
    });
	
    $('#boldTrigger').click(function(){
    	$('.modal-close').click();
      	$('#checkout_11118 a').click();
    });
    
    $('.modal-close').click(function(){
      modal.hide();
      $('body').css('overflow', 'auto');

      if(idYes_modal != '' && idNo_modal != ''){
        $('#'+idYes_modal).removeAttr('checked');
        $('#'+idNo_modal).prop('checked',true);

        idYes_modal = '';
        idNo_modal = '';
      }
    });

    $(window).click(function(e){
      if (e.target == modalDom){
        modal.hide();
        $('body').css('overflow', 'auto');

        if(idYes_modal != '' && idNo_modal != ''){
          $('#'+idYes_modal).removeAttr('checked');
          $('#'+idNo_modal).prop('checked',true);

          idYes_modal = '';
          idNo_modal = '';
        }
      }
    });

    function get_cart_items(){
        $('.collection_to_cart').show();
        $('.collection_update').hide();
        $('.collection_update').css('opacity', 0);

        $.ajax({
          type:'GET', 
          url:'/cart.js', 
          dataType: 'json',
          success: function(data){
            var items = data.items;

            cart_items = items;

            for(var i in items){
              var temp = [];

              if(items[i].merged)
                continue;

              temp.product_id = items[i].product_id;
              temp.quantity = parseInt(items[i].quantity);
              items[i].merged = true;

              for(var j in items){
                if(i >= j || items[j].merged)
                  continue;

                if(items[i].product_id == items[j].product_id){
                  temp.quantity += parseInt(items[j].quantity);
                  items[j].merged = true;
                }
              }

              var id = 'collection_count_' + temp.product_id;
              $('#'+id).html(temp.quantity);

              var object = $('#'+id).parents('.collection_action:first');
              object.find('.collection_to_cart:first').hide();
              object.find('.collection_update:first').show();
              object.find('.collection_update:first').css('opacity', 1);
            }
          }
        });
    }
    
    $('body').on('afterChangeItem.ajaxCart', function(evt, cart) {
      get_cart_items();
    });

    $('body').on('afterAddItem.ajaxCart', function(evt, cart) {
      get_cart_items();
    });

    function find_cart_quantity(id, action){
        var quantity = 0;
        if(cart_items.length > 0){
            for(var i in cart_items){
                if(cart_items[i].id == id){
                    if(action == 'minus')
                        cart_items[i].quantity -= 1;
                    else if(action == 'plus')
                        cart_items[i].quantity += 1;      

                    quantity = cart_items[i].quantity;

                    break;
                }
            }
        }

        return parseInt(quantity);
    }

    function update_cart_count(action){
        var quantity = parseInt($('#CartCount').html());
        
        if(action == 'minus')
            quantity--;
        else if(action == 'plus')
            quantity++;

        $('#CartCount').html(quantity);
        $('#CartCount_mobile').html(quantity);
    }

    get_cart_items();
    
    $(window).load(function(){
      var match = new RegExp('[?&]cart=([^&]*)').exec(window.location.href);

      var param = match && decodeURIComponent(match[1].replace());

      if(param == 'show'){
          ajaxCart.load();
          timber.RightDrawer.open()
      }
    });
  });
  $(document).ready(function(){
    $("#boldTrigger").click(function(){ 	 
    	amplitude.getInstance().logEvent('all products cta one month free ');
    });   
  })
</script>