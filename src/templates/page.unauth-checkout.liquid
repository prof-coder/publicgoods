{% layout 'theme.unauthorized-checkout' %}
<!-- /templates/page.liquid -->
{% comment %}
<div id="page_content">
  <div class="row clearfix">
  	<div class="column_12">
      <h1>{{ page.title }}</h1>
      <div class="rte">
      	{{ page.content }}
        {% for product in collections['all-products'].products | limit: 30 %}
        	{%- comment %}<locksmith:ab1b>{% endcomment -%}
        	  {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collections.all-products, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
        	{%- comment %}</locksmith:ab1b>{% endcomment -%}
        	<div class="unauth-co-item" data-href="/cart/add.js?id={{ product.first_available_variant.id }}">
		        {% include 'product-grid-item-unauthorized' %}
	        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endcomment %}

<div id="page_content">
  <div class="row">
    <div class="column_12">
      <div class="collections clearfix">
        {% paginate collections.all-products.products by 300 %}
          {% for product in collections.all-products.products %}
            {%- comment %}<locksmith:0d51>{% endcomment -%}
              {%- capture var %}{% render 'locksmith-variables', scope: 'subject', subject: product, subject_parent: collections.all-products, variable: 'transparent' %}{% endcapture %}{% if var == "true" %}{% else %}{% continue %}{% endif -%}
            {%- comment %}</locksmith:0d51>{% endcomment -%}
            {% assign name = 'product' | append:product.id %}
            {% assign idNo = name | append:'-no' %}
            {% assign idYes = name | append:'-yes' %}
            {% assign checkedNo = 'checked' %}
            {% assign checkedYes = '' %}
            {% assign opacityClass = '' %}
            {% assign available = true %}
            {% if product.variants[0].inventory_quantity <= 20 %}
              {% assign available = false %}
            {% endif %}
            <div class="collection">
              <div class="collection_header">
                <a href="{{ product.url | within: collection }}">
                  <div class="reveal">
                    <img src="{{ product.featured_image.src | img_url: 'master' }}" alt="{{ product.featured_image.alt | escape }}">
                    <img class="hidden" src="{{ product.images.last | img_url: 'master' }}" alt="{{ product.images.last.alt | escape }}" />
                  </div>
                </a>
                <div class="collection_action" rel="{{name}}">
                  {% if available == true %}
                    <div
                         class="memberships_app-collection_to_cart"
                         data-href="/cart/add.js"
                         data-id="{{ product.first_available_variant.id }}"
                         rel="{{name}}">ADD TO CART</div>
                    <div class="collection_update">
                      <div class="collection_update_spans clearfix">
                        <span class="collection_minus" rel="{{name}}"></span>
                        <div>
                          <span class="collection_count" id="collection_count_{{product.id}}"></span> IN CART
                        </div>
                        <span class="collection_plus" rel="{{name}}"></span>
                      </div>
                    </div>
                  {% else %}
                    <div class="collection_coming_soon"><a href="{{ product.url | within: collection }}#sold-out">SOLD OUT</a></div>
                  {% endif %}
                </div>
              </div>
              <div class="collection_body">
                <label class="collection_title all-products-product-stars"><a href="{{ product.url | within: collection }}">{{ product.title }}</a> 
                  <a href="{{ product.url | within: collection | append: '#anchor-reviews'}}">
                    <div class="yotpo bottomLine yotpo-small"
                      data-appkey="1czk4hDZQU9jrmp3MaNi1wqhc05RABHrg6aDSVLd"
                      data-domain="{{shop.permanent_domain | escape }}"
                      data-product-id="{{ product.id }}"
                      data-product-models="{{ product.id }}"
                      data-name="{{ product.title | escape }}"
                      data-url="{{ shop.url }}{{ product.url }}"
                      data-image-url="{{ product.featured_image | product_img_url: 'large' |replace: '?', '%3F' | replace: '&','%26'}}"
                      data-description="{{ product.description | escape }}"
                      data-bread-crumbs="{% for tag in product.tags %}{{ tag | escape }};{% endfor %}">
                    </div>
                  </a>
                </label>
                <div class="var_checkbox" style="display:block;">
                  <input type="hidden" name="{{name}}" id="{{idYes}}" value="{{ product.variants[0].id }}" class="productYes" {{checkedYes}}/>
                  <label style="cursor:default;" for="{{idYes}}">
                    {{ product.variants[0].price | money }}
                    <font>{{ product.variants[0].title | remove: '(member)'}}
                      <small>{% unless customer %}With membership, from $59 / year{% endunless %}</small>
                    </font>
                  </label>
                </div>
              </div>
            </div>
          {% endfor %}
          {% if paginate.pages > 1 %}
            <div class="pagination">
              {{ paginate | default_pagination | replace: '&laquo; Previous', '&larr;' | replace: 'Next &raquo;', '&rarr;' }}
            </div>
          {% endif %}
        {% endpaginate %}
      </div>
    </div>
  </div>
</div>

<script>
  $(function(){
    $('.memberships_app-collection_to_cart').on('click', function(e){
	    e.preventDefault();
      
      $.ajax({
        method: 'get',
        url: this.dataset.href,
        data: {
	        id: this.dataset.id
      	},
        complete: function(response) {
          if(response.status === 200) {
          	ajaxCart.load();	
          }
        }
      });
      return false;
    });
  });
</script>